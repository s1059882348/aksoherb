(function(){window.IM=window.IM||{_appid:"",_3rdServer:"3rd.php.htm"/*tpa=http://www.aksoherb.com/webim/3rd.php*/,_user_account:null,_content_you:null,_timeoutkey:null,_username:null,_user_account:null,_contact_type_c:"C",_contact_type_g:"G",_contact_type_m:"M",_onMsgReceiveListener:null,_onDeskMsgReceiveListener:null,_noticeReceiveListener:null,_onConnectStateChangeLisenter:null,_isMcm_active:false,_local_historyver:0,_msgId:null,_pre_range:null,_pre_range_num:0,_name:"",_userdata:{},autoreply:function(){if(IM._userdata.is_auto_reply==0){if(IM._userdata.auto_reply.status==1){if(IM._userdata.bname!=""){var a=IM._userdata.auto_reply.content.replace("[EMAIL]",IM._userdata.bname)}else{var a=IM._userdata.auto_reply.content.replace("[EMAIL]",IM._userdata.bemail)}if(IM._userdata.pname==""){IM._userdata.pname="our products"}a=a.replace("[PNAME]",IM._userdata.pname);var b='<div msg="msg" class="alert alert-left alert-info" style="block"><img src="img/wap3_03.png"/*tpa=http://www.aksoherb.com/webim/img/wap3_03.png*/ class="header_icon"><pre  class="youspeak">'+a+"</pre></div>";$("#im_content_list").append(b);IM._userdata.is_auto_reply=1}}},init:function(b){IM._appid=b;var c=RL_YTX.init(IM._appid);if(!c){return}if(211001==c.code){var a=confirm(c.msg);if(a==true||a==false){window.close()}}else{if(211002==c.code){}else{if(200==c.code){IM.HTML_resetHei();window.onresize=function(){IM.HTML_resetHei()};IM.initEmoji();IM.initEvent();IM.DO_login()}else{}}}},initEvent:function(){$("#im_send_content").bind("paste",function(){IM.DO_pre_replace_content()})},initEmoji:function(){var d=$("#emoji_div").find('div[class="popover-content"]');for(var e in emoji.show_data){var f=emoji.show_data[e];var b=emoji.replace_unified(f[0][0]);var a='<span style="cursor:pointer; margin: 0 2px 0 4px;" onclick="IM.DO_chooseEmoji(\''+e+"', '"+f[0][0]+'\')" imtype="content_emoji">'+b+"</span>";d.append(a)}},_keyCode_1:0,_keyCode_2:0,EV_keyCode:function(a){IM._keyCode_1=IM._keyCode_2;IM._keyCode_2=a.keyCode;if(IM._userdata.device!=1){if(a.shiftKey&&13==IM._keyCode_2||a.altKey&&13==IM._keyCode_2){a.returnValue=true}else{if(13==IM._keyCode_2&&!$("#sendmsgBtn").prop("disabled")){a.returnValue=false;IM.DO_sendMsg()}}}},DO_login:function(){var a=IM._user_account;if(a==""||a==undefined||a==null){return}IM._login(a)},_login:function(a){var b=IM._getTimeStamp();IM._privateLogin(a,b,function(c){IM.EV_login(a,c.sig,b)},function(c){alert(c.msg)})},_privateLogin:function(b,e,f,c){var d={appid:IM._appid,username:b,timestamp:e};var a=IM._3rdServer;$.ajax({url:a,dataType:"jsonp",data:d,jsonp:"cb",success:function(g){if(g.code!=0){var h={};h.code=g.code;h.msg="Get SIG fail from 3rd server!...";c(h);return}else{var h={};h.code=g.code;h.sig=g.sig;f(h);return}},error:function(){var g={};g.msg="Get SIG fail from 3rd server!";c(g)},timeout:15000})},EV_login:function(b,d,c){var a=new RL_YTX.LoginBuilder(1,b,"",d,c);RL_YTX.login(a,function(f){IM._user_account=b;IM._username=b;IM._onMsgReceiveListener=RL_YTX.onMsgReceiveListener(function(g){IM.EV_onMsgReceiveListener(g)});IM._onConnectStateChangeLisenter=RL_YTX.onConnectStateChangeLisenter(function(g){if(1==g.code){}else{if(2==g.code){IM.HTML_showAlert("alert-warning","网络状况不佳，正在试图重连服务器",10*60*1000)}else{if(3==g.code){IM.HTML_showAlert("alert-success","连接成功")}else{if(4==g.code){IM.DO_logout();alert(g.msg)}else{if(5==g.code){IM.HTML_showAlert("alert-warning","网络状况不佳，正在试图重连服务器");IM._login(IM._user_account)}else{}}}}}});$("#navbar_user_account").removeAttr("readonly");IM.EV_getMyInfo();IM.HTML_LJ_none();if(IM._local_historyver<=parseInt(f.historyver)&&parseInt(f.historyver)<parseInt(f.version)){IM._local_historyver=parseInt(f.historyver);IM.EV_syncMsg(parseInt(f.historyver)+1,f.version)}var e=new RL_YTX.UploadPersonInfoBuilder();e.setNickName("即时询盘");RL_YTX.uploadPerfonInfo(e,function(g){},function(g){})},function(e){$("#navbar_user_account").removeAttr("readonly");alert("error code: "+e.code)})},EV_logout:function(){IM.DO_logout();RL_YTX.logout(function(){},function(a){alert("error code: "+a.code)})},DO_logout:function(){IM._onMsgReceiveListener=null;IM._onDeskMsgReceiveListener=null;IM._noticeReceiveListener=null;IM._onConnectStateChangeLisenter=null;$("#im_contact_list").empty();$("#im_content_list").empty();IM.HTML_pop_photo_hide();IM.HTML_pop_hide();$("#emoji_div").hide();IM.HTML_closeAlert("all");IM.DO_choose_contact_type("C");IM.HTML_LJ_block("black")},EV_onMsgReceiveListener:function(b){IM.DO_push_createMsgDiv(b);var c=("g"==b.msgReceiver.substr(0,1));if(c){var a=$("#im_contact_"+b.msgReceiver).attr("im_isnotice");if(2!=a){document.getElementById("im_ring").play()}}else{document.getElementById("im_ring").play()}},EV_noticeReceiveListener:function(a){IM.DO_notice_createMsgDiv(a);document.getElementById("im_ring").play()},EV_sendTextMsg:function(a,d,b){var c=new RL_YTX.MsgBuilder();c.setId(a);c.setText(d);c.setType(1);c.setReceiver(b);c.setDomain(JSON.stringify(IM._userdata));RL_YTX.sendMsg(c,function(){$("#"+b+"_"+a).find('span[imtype="resend"]').css("display","none");IM.autoreply()},function(e){$("#"+b+"_"+a).find('span[imtype="resend"]').css("display","block");alert("error code: "+e.code)})},EV_resendMsg:function(b){var g=$("#"+b);b=b.substring(b.lastIndexOf("_")+1);var a=g.attr("im_msgtype");var e=g.attr("content_you");if(1==a){g.find('span[imtype="resend"]').css("display","none");var f=g.find('pre[msgtype="content"]').html();IM.EV_sendTextMsg(b,f,e)}else{if(4==a||6==a){var d=g.attr("content_type");var c=g.find('input[imtype="msg_attach_resend"]')[0].files[0];if(IM._contact_type_m==d){IM.EV_sendToDeskAttachMsg(b,c,a,e)}else{IM.EV_sendAttachMsg(b,c,a,e)}}else{}}},EV_sendAttachMsg:function(c,a,b,d){var e=new RL_YTX.MsgBuilder();e.setId(c);e.setFile(a);e.setType(b);e.setReceiver(d);e.setDomain(Base64.encode(JSON.stringify(IM._userdata)));var f=$("#"+d+"_"+c);f.attr("msg","msg");f.css("display","block");$("#im_content_list").scrollTop($("#im_content_list")[0].scrollHeight);RL_YTX.sendMsg(e,function(){f.find('span[imtype="resend"]').css("display","none");f.find('span[imtype="msg_attach_sended"]').css("display","none");f.find('span[imtype="msg_attach_down"]').css("display","display");f.find('span[imtype="msg_attach"]').css("display","block");f.attr("msg","msg");IM.autoreply()},function(g){f.find('span[imtype="resend"]').css("display","block");f.find('span[imtype="msg_attach_sended"]').css("display","none");f.find('span[imtype="msg_attach"]').css("display","block");alert("error code: "+g.code)},function(h,g){if(h<g){f.find('span[imtype="msg_attach_sended"]').text(h/g*100+"%");f.find('span[imtype="msg_attach_waitimg"]').css("display","display")}else{f.find('span[imtype="msg_attach_sended"]').css("display","none");f.find('span[imtype="msg_attach_down"]').css("display","display");f.find('span[imtype="msg_attach_waitimg"]').css("display","none");f.find('span[imtype="msg_attach"]').css("display","block")}})},EV_sendToDeskAttachMsg:function(c,a,b,d){var e=new RL_YTX.DeskMessageBuilder();e.setMsgId(c);e.setFile(a);e.setType(b);e.setOsUnityAccount(d);e.setDomain(Base64.encode(JSON.stringify(IM._userdata)));var f=$("#"+d+"_"+c);f.attr("msg","msg");f.css("display","block");$("#im_content_list").scrollTop($("#im_content_list")[0].scrollHeight);RL_YTX.sendToDeskMessage(e,function(){f.find('span[imtype="resend"]').css("display","none");f.find('span[imtype="msg_attach_sended"]').css("display","none");f.find('span[imtype="msg_attach_down"]').css("display","display");f.find('span[imtype="msg_attach"]').css("display","block");f.attr("msg","msg");IM.autoreply()},function(g){f.find('span[imtype="resend"]').css("display","block");f.find('span[imtype="msg_attach_sended"]').css("display","none");f.find('span[imtype="msg_attach"]').css("display","block");alert("error code: "+g.code)},function(h,g){if(h<g){f.find('span[imtype="msg_attach_sended"]').text(h/g*100+"%");f.find('span[imtype="msg_attach_waitimg"]').css("display","display")}else{f.find('span[imtype="msg_attach_sended"]').css("display","none");f.find('span[imtype="msg_attach_down"]').css("display","display");f.find('span[imtype="msg_attach_waitimg"]').css("display","none");f.find('span[imtype="msg_attach"]').css("display","block")}})},EV_startMcmMsg:function(a){var b=new RL_YTX.DeskMessageStartBuilder();b.setOsUnityAccount(a);b.setUserData("");RL_YTX.startConsultationWithAgent(b,function(){},function(c){alert("error code: "+c.code)})},EV_stopMcmMsg:function(a){var b=new RL_YTX.DeskMessageStopBuilder();b.setOsUnityAccount(a);b.setUserData("");RL_YTX.finishConsultationWithAgent(b,function(){},function(c){alert("error code: "+c.code)})},EV_sendMcmMsg:function(a,d,b){var c=new RL_YTX.DeskMessageBuilder();c.setContent(d);c.setUserData();c.setMsgId(a);c.setType(1);c.setOsUnityAccount(b);RL_YTX.sendToDeskMessage(c,function(){$("#"+a).find('span[imtype="resend"]').css("display","none")},function(e){$("#"+a).find('span[imtype="resend"]').css("display","block");alert("error code: "+e.code)})},EV_syncMsg:function(a,b){var c=new RL_YTX.SyncMsgBuilder();c.setSVersion(a);c.setEVersion(b);RL_YTX.syncMsg(c,function(d){alert("error code: "+d.code)})},EV_getMyInfo:function(){RL_YTX.getMyInfo(function(a){if(!!a&&!!a.nickName){IM._username=a.nickName}},function(a){if(520015!=a.code){alert("error code: "+a.code)}})},getUnicodeCharacter:function(b){if(b>=0&&b<=55295||b>=57344&&b<=65535){return String.fromCharCode(b)}else{if(b>=65536&&b<=1114111){b-=65536;var c=((1047552&b)>>10)+55296;var a=(1023&b)+56320;return String.fromCharCode(c)+String.fromCharCode(a)}}},DO_push_createMsgDiv:function(g){var n=("g"==g.msgReceiver.substr(0,1));var l=(n)?g.msgReceiver:g.msgSender;var q=g.senderNickName;var b=g.msgSender;if(!!q){b=q}var p=IM.DO_createMsgDiv_Help(l,b,n);var e=g.msgContent;var i=null;var j=g.version;var d=g.msgDateCreated;if(0==g.mcmEvent){i=(n)?IM._contact_type_g:IM._contact_type_c;var h=g.msgType;var k="";if(1==h||0==h){h=1;k=emoji.replace_unified(e);k='<img src="img/wap3_03.png"/*tpa=http://www.aksoherb.com/webim/img/wap3_03.png*/ class="header_icon"><pre class="youspeak">'+k+"</pre>"}else{if(2==h){var a=g.msgFileUrl;k='<audio controls="controls" src="'+a+'">your browser does not surpport the audio element</audio>'}else{if(3==h){var a=g.msgFileUrl;k="你接收了一条视频消息["+a+"]"}else{if(4==h){var a=g.msgFileUrl;var c=$(window).width();var o=0;var m=0;if(c<666){o=100;m=150}else{o=150;m=200}var k='<a href="'+a+'" target="_blank"><img src="'+a+'" style="max-width:'+o+"px; max-height:"+m+'px;"/></a>'}else{if(5==h){k="你接收了一条位置消息..."}else{if(6==h){var a=g.msgFileUrl;var f=g.msgFileName;k='<a href="'+a+'" target="_blank"><span><img style="width:32px; height:32px; margin-right:5px; margin-left:5px;" src="assets/img/attachment_icon.png"/*tpa=http://www.aksoherb.com/webim/assets/img/attachment_icon.png*/ /></span><span>'+f+"</span></a>"}}}}}}IM.HTML_pushMsg_addHTML(h,l,j,i,p,b,k)}else{if(1==g.mcmEvent){IM.HTML_pushMsg_addHTML(g.msgType,l,j,IM._contact_type_m,p,b,e)}else{if(2==g.mcmEvent){IM.HTML_pushMsg_addHTML(g.msgType,l,j,IM._contact_type_m,p,b,"结束咨询")}else{if(3==g.mcmEvent){IM.HTML_pushMsg_addHTML(g.msgType,l,j,IM._contact_type_m,p,b,e)}else{if(53==g.mcmEvent){i=IM._contact_type_m;var h=g.msgType;var k="";if(1==h||0==h){h=1;k=emoji.replace_unified(e);k='<img src="img/wap3_03.png"/*tpa=http://www.aksoherb.com/webim/img/wap3_03.png*/ class="header_icon"><pre  class="youspeak">'+k+"</pre>"}else{if(2==h){var a=g.msgFileUrl;k='<audio controls="controls" src="'+a+'">your browser does not surpport the audio element</audio>'}else{if(3==h){var a=g.msgFileUrl;k="你接收了一条视频消息["+a+"]"}else{if(4==h){var a=g.msgFileUrl;var c=$(window).width();var o=0;var m=0;if(c<666){o=100;m=150}else{o=150;m=200}var k='<a href="'+a+'" target="_blank"><img src="'+a+'" style="max-width:'+o+"px; max-height:"+m+'px;"/></a>'}else{if(5==h){k="你接收了一条位置消息..."}else{if(6==h){var a=g.msgFileUrl;var f=g.msgFileName;k='<a href="'+a+'" target="_blank"><span><img style="width:32px; height:32px; margin-right:5px; margin-left:5px;" src="assets/img/attachment_icon.png"/*tpa=http://www.aksoherb.com/webim/assets/img/attachment_icon.png*/ /></span><span>'+f+"</span></a>"}}}}}}IM.HTML_pushMsg_addHTML(h,l,j,i,p,b,k)}}}}}},DO_pop_phone:function(f,a){var c=f+"_"+a;IM._msgId=c;var e=$("#"+c);var b=e.find("img").attr("src");var d=$("#pop_photo");d.find("img").attr("src",b);IM.HTML_pop_photo_show()},HTML_pop_photo_show:function(){IM.HTML_LJ_block("photo");var j=$("#navbar").height();var g=$("#lvjing").height();var i=$("#pop_photo");i.find("img").css("max-height",g-30).css("max-width",$(window).width()-50);i.css("top",j);var h=$(window).scrollTop();var f=parseInt(i.find('div[imtype="pop_photo_top"]').css("margin-top"));var e=parseInt(i.find('div[imtype="pop_photo_top"]').css("height"));var k=$(window).height();if(f+e>=k){h=0}else{if(h+e>=k){h=k-e-20}}i.find('div[imtype="pop_photo_top"]').css("margin-top",h);$(window).scrollTop(h);i.show()},DO_pop_photo_up:function(){var c=$("#"+IM._msgId);if(c.length<1){return}var a=-1;c.parent().find('div[msg="msg"][im_msgtype="4"]:visible').each(function(){a++;if(IM._msgId==$(this).attr("id")){a--;return false}});if(a<0){return}var d=c.parent().children('div[msg="msg"][im_msgtype="4"]:visible').eq(a);if(d.length<1){return}var b=d.find("img").attr("src");$("#pop_photo").find("img").attr("src",b);IM._msgId=d.attr("id")},DO_pop_photo_down:function(){var d=$("#"+IM._msgId);if(d.length<1){return}var a=-1;d.parent().find('div[msg="msg"][im_msgtype="4"]:visible').each(function(){a++;if(IM._msgId==$(this).attr("id")){a++;return false}});if(a<0){return}var b=d.parent().children('div[msg="msg"][im_msgtype="4"]:visible').eq(a);if(b.length<1){return}var c=b.find("img").attr("src");$("#pop_photo").find("img").attr("src",c);IM._msgId=b.attr("id")},DO_checkPopShow:function(a){if($("#pop_group_"+a).length<=0){return false}var b=$("#pop").css("display");if(b!="block"){return false}return true},HTML_remove_contact:function(a){$("#im_contact_"+a).remove();$("#im_content_list").find('div[content_you="'+a+'"]').each(function(){$(this).remove()})},DO_createMsgDiv_Help:function(f,d,e){var c=true;$("#im_contact_list").find("li").each(function(){if(f==$(this).attr("contact_you")){if($(this).hasClass("active")){c=true}}});var b="C";var a=false;if(IM._contact_type_g==b&&e){a=true}if(IM._contact_type_c==b&&!e){a=true}IM.HTML_addContactToList(f,d,(e)?IM._contact_type_g:IM._contact_type_c,false,a,false,null,null);return c},HTML_find_contact_type:function(){var a=null;$("#im_contact_type").find("li").each(function(){if($(this).hasClass("active")){a=$(this).attr("contact_type")}});return a},HTML_pushMsg_addHTML:function(c,m,j,h,l,a,f){var k='<div msg="msg" im_msgtype="'+c+'" id="'+m+"_"+j+'" content_type="'+h+'" content_you="'+m+'" class="alert alert-left alert-info" style="display:'+((l)?"block":"none")+'">'+f+"</div>";$("#im_content_list").append(k);var e=$(window.parent.document).find(".layui-layer-min").css("display");if(e=="none"){$(window.parent.document).find(".imgtips").remove();$(window.parent.document).find(".layui-layer-max").prepend("<img id=imgtips class=imgtips src=images/webim.gif>")}setTimeout(function(){$("#im_content_list").scrollTop($("#im_content_list")[0].scrollHeight)},100);var g=$("#im_contact_"+m);if(!g.hasClass("active")){var i=g.find('span[contact_style_type="warn"]');if("99+"==i.html()){return}var d=parseInt((!!i.html())?i.html():0)+1;if(d>99){i.html("99+")}else{i.html(d)}i.show()}},HTML_sendMsg_addHTML:function(g,c,d,b,a,h){h=emoji.replace_unified(h);var e=("temp_msg"==g)?"none":"block";var f='<div msg="'+g+'" im_msgtype="'+c+'" id="'+a+"_"+d+'" content_type="'+b+'" content_you="'+a+'" class="alert alert-right alert-success" style="display:'+e+'"><span imtype="resend" class="add-on" onclick="IM.EV_resendMsg(\''+a+"_"+d+'\')" style="display:none; cursor:pointer; position: relative; left: -40px; top: 0px;"><i class="icon-repeat"></i></span>'+h+"</div>";$("#im_content_list").append(f);$("#im_send_content").html("");$("#im_content_list").scrollTop($("#im_content_list")[0].scrollHeight);return a+"_"+d},DO_chooseContactList:function(c,b){IM.HTML_clean_im_contact_list();var a=$("#im_contact_"+b);a.addClass("active");var d=a.find('span[contact_style_type="warn"]');d.hide();d.html(0);IM.HTML_clean_im_content_list(b);if(IM._contact_type_m==c){IM.EV_startMcmMsg(b);IM._isMcm_active=true}else{if(IM._isMcm_active){IM.EV_stopMcmMsg(b)}}},HTML_clean_im_content_list:function(a){$("#im_content_list").find('div[msg="msg"]').each(function(){if($(this).attr("content_you")==a){$(this).show()}else{$(this).hide()}});$("#im_content_list").scrollTop($("#im_content_list")[0].scrollHeight)},HTML_clean_im_contact_list:function(){$("#im_contact_list").find("li").each(function(){$(this).removeClass("active")})},DO_addContactToList:function(){var a=$("#im_add").find('input[imtype="im_add_contact"]').val();if(!IM.DO_checkContact(a)){return}var b=$("#im_contact_list").find('li[contact_type="'+IM._contact_type_c+'"][contact_you="'+a+'"]');if(b.length<=0){IM.HTML_clean_im_contact_list();IM.HTML_addContactToList(a,a,IM._contact_type_c,true,true,false,null,null);IM.HTML_clean_im_content_list(a)}$("#im_add").find('input[imtype="im_add_contact"]').val("")},DO_checkContact:function(c){if(!c){IM.HTML_showAlert("alert-warning","请填写联系人");return false}if(c.length>128){IM.HTML_showAlert("alert-error","联系人长度不能超过128");return false}if("g"==c.substr(0,1)){IM.HTML_showAlert("alert-error",'联系人不能以"g"开始');return false}if(c.indexOf("@")>-1){var a=/[a-zA-Z0-9_-]{1,}@(([a-zA-z0-9]-*){1,}\\.){1,3}[a-zA-z\\-]{1,}/;if(a.exec(c)==null){IM.HTML_showAlert("alert-error","邮箱格式不正确");return false}}else{var b=/^[A-Za-z0-9_-]+$/;if(b.exec(c)==null){IM.HTML_showAlert("alert-error","联系人只能使用数字、_、-、大小写英文");return false}}return true},HTML_addContactToList:function(a,l,h,k,i,m,c,g){var e=$("#im_contact_"+a);if(!!e&&e.length>0){if(m){e.find('span[contact_style_type="name"]').html(l)}var j=e.prop("outerHTML");e.remove();$("#im_contact_list").prepend(j);return}if(IM._contact_type_m==h){}var f="";if(k){f="active"}var d="none";if(i){d="block"}var j="<li onclick=\"IM.DO_chooseContactList('"+h+"', '"+a+'\')" id="im_contact_'+a+'" im_isnotice="'+g+'" contact_type="'+h+'" contact_you="'+a+'" class="'+f+'"  style="display:'+d+'"><a href="#"><span contact_style_type="name">'+l+"</span>";if(IM._contact_type_g==h){j+='<span class="pull-right" onclick="IM.DO_groupMenu(\''+a+"', '"+c+'\');"><i class="icon-wrench"></i></span>'}j+='<span contact_style_type="warn" class="badge badge-warning pull-right" style="margin-top:3px; margin-right:10px; display:none;">0</span></a></li>';$("#im_contact_list").prepend(j);if(k){IM.DO_chooseContactList(h,a)}},HTML_showInviteArea:function(){var b=$("#pop").find('table[imtype="im_pop_members_add"]');var a=b.children().children().next().children();a.children().hide();a.children().next().show();a.children().next().next().show()},HTML_hideInviteArea:function(){var b=$("#pop").find('table[imtype="im_pop_members_add"]');var a=b.children().children().next().children();a.children().show();a.children().next().hide();a.children().next().next().hide()},HTML_showMemberName:function(a,b){var d=$("#pop").find('tr[contact_you="'+a+'"]');var c=d.children().children().children().next();c.html(b)},HTML_pop_photo_hide:function(){IM._msgId=null;$("#pop_photo").hide();IM.HTML_LJ_none()},HTML_pop_show:function(){IM.HTML_LJ_block("white");var c=$("#navbar").height();var b=$(".scrollspy-content-example").height();var a=$("#pop");a.css("top",c+20);a.css("height",b);a.show()},HTML_pop_hide:function(){$("#pop").hide();IM.HTML_LJ_none()},HTML_closeAlert:function(a){if("all"==a){IM.HTML_closeAlert("alert-error");IM.HTML_closeAlert("alert-info");IM.HTML_closeAlert("alert-warning");IM.HTML_closeAlert("alert-success")}else{$("#"+a).parent().css("top","0px");$("#"+a).hide();$("#"+a).parent().hide()}},HTML_showAlert:function(d,c,b){var a=3*1000;if(!!b){a=b}clearTimeout(IM._timeoutkey);$("#alert-info").hide();$("#alert-warning").hide();$("#alert-error").hide();$("#alert-success").hide();$("#"+d+"_content").html(c);$("#"+d).parent().css("top","-5px");$("#"+d).show();$("#"+d).parent().show();IM._timeoutkey=setTimeout(function(){IM.HTML_closeAlert(d)},a)},HTML_resetHei:function(){var e=$(window).height();if(e<666){e=666}var b=$("#navbar").height()+20+60+30+20+1;var d=$("#im_contact_type").height()+20+6;var a=$("#im_add_contact").height()+10+10;var c=e-b-d-a-20;$(".scrollspy-contact-example").height(c);if(IM._userdata.device!=1){$(".scrollspy-content-example").height(c+d-10-10-75)}$("#im_content_list").scrollTop($("#im_content_list")[0].scrollHeight);if("block"==$("#pop_photo").css("display")){IM.HTML_pop_photo_show()}else{if("block"==$("#pop").css("display")){IM.HTML_pop_show()}}},HTML_LJ:function(b){var f=$("#lvjing");var a=$("#navbar").height();var i=($("#hero-unit").height()+20+60+30);var j=($("#hero-unit").width()+parseInt($("#hero-unit").css("padding-left"))+parseInt($("#hero-unit").css("padding-right")));var h=f.find("img").height();if(0==h){h=198}f.css("top",a);f.css("left",0);f.css("width","100%");f.height(i+15);var e=document.getElementById("lvjing_canvas");e.clear;e.height=(i+15);e.width=j;if(!e.getContext){return}var d=e.getContext("2d");d.clear;d.beginPath();d.moveTo(0,0);d.lineTo(j,0);d.lineTo(j,i+15);d.lineTo(0,i+15);d.closePath();d.globalAlpha=0.4;if("white"==b){d.fillStyle="rgb(200,200,200)";f.find("img").hide()}else{if("photo"==b){d.fillStyle="rgb(20,20,20)";f.find("img").hide()}else{if("black"==b){d.fillStyle="rgb(0,0,0)";var g=f.find("img");g.css("top",i/2-h/2);g.css("left",j/2-h/2);g.show()}}}d.fill();d.stroke();var c=a+4;if(a>45){c=0}setTimeout(function(){$("#ClCache").parent().remove()},20)},HTML_LJ_none:function(){$("#lvjing").hide();$("#sendmsgBtn").css({background:"#ff9c00"});$("#sendmsgBtn").html($("#sendmsgBtn_send").html());$("#sendmsgBtn").attr("disabled",false)},HTML_LJ_block:function(a){IM.HTML_LJ(a);$("#lvjing").show();$("#sendmsgBtn").css({background:"#666"});$("#sendmsgBtn").html($("#sendmsgBtn_connecting").html());$("#sendmsgBtn").attr("disabled",true)},DO_choose_contact_type:function(b){$("#im_contact_type").find("li").each(function(){$(this).removeClass("active");if(b==$(this).attr("contact_type")){$(this).addClass("active")}});$("#im_contact_list").find("li").each(function(){if(b==$(this).attr("contact_type")){$(this).show()}else{$(this).hide()}});var a=IM.HTML_find_contact_type();var c=$("#im_add");if(IM._contact_type_c==a){c.find("i").attr("class","").addClass("icon-user");c.find('input[imtype="im_add_contact"]').show();c.find('input[imtype="im_add_group"]').hide();c.find('input[imtype="im_add_mcm"]').hide();c.find('button[imtype="im_add_btn_contact"]').show();c.find('div[imtype="im_add_btn_group"]').hide()}else{if(IM._contact_type_g==a){c.find("i").attr("class","").addClass("icon-th-list");c.find('input[imtype="im_add_contact"]').hide();c.find('input[imtype="im_add_group"]').show();c.find('input[imtype="im_add_mcm"]').hide();c.find('button[imtype="im_add_btn_contact"]').hide();c.find('div[imtype="im_add_btn_group"]').show()}else{if(IM._contact_type_m==a){c.find("i").attr("class","").addClass("icon-home");c.find('input[imtype="im_add_contact"]').hide();c.find('input[imtype="im_add_group"]').hide();c.find('input[imtype="im_add_mcm"]').show();c.find('button[imtype="im_add_btn_contact"]').hide();c.find('div[imtype="im_add_btn_group"]').hide()}else{}}}},DO_sendMsg:function(){var f=IM.DO_pre_replace_content_to_db();$("#im_send_content_copy").html(f);$("#im_send_content_copy").find('img[imtype="content_emoji"]').each(function(){var b=$(this).attr("emoji_value_unicode");$(this).replaceWith(b)});var g=$("#im_send_content_copy").html();$("#im_send_content_copy").html("");$("#emoji_div").hide();var e=new Date().getTime();var d="C";var c=IM._content_you;var a=true;if(g==undefined||g==null||g==""){return}g=g.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&nbsp;/g," ");var f='<img src="img/wap3_07.png"/*tpa=http://www.aksoherb.com/webim/img/wap3_07.png*/  class="header_icon"><pre msgtype="content" class="ownspeak">'+g+"</pre>";IM.HTML_sendMsg_addHTML("msg",1,e,d,c,f);if(IM._contact_type_c==d){IM.EV_sendTextMsg(e,g,c)}else{if(IM._contact_type_g==d){IM.EV_sendTextMsg(e,g,c)}else{IM.EV_sendMcmMsg(e,g,c)}}},DO_im_image_file:function(){var a=new Date().getTime();var e="C";var f=IM._content_you;var h=true;var d=$(window).width();var j=0;var i=0;if(d<666){j=100;i=150}else{j=150;i=200}var g='<span imtype="msg_attach_waitimg" style="display: none;"><img src="img/waitimg.gif"/*tpa=http://www.aksoherb.com/webim/img/waitimg.gif*/></span><span imtype="msg_attach"><a href="#" imtype="msg_attach_src_big" target="_blank"><img imtype="msg_attach_src" src="#" style="max-width:'+j+"px; max-height:"+i+'px;"/></a><input imtype="msg_attach_resend" type="file" accept="image/*" style="display:none;margin: 0 auto;" onchange="IM.DO_im_image_file_up(\''+f+"_"+a+"', '"+a+"')\"></span>";var c=IM.HTML_sendMsg_addHTML("temp_msg",4,a,e,f,g);$("#"+c).find('input[imtype="msg_attach_resend"]').click()},DO_im_image_file_up:function(e,b){var f=$("#"+e);var h=f.find('input[imtype="msg_attach_resend"]')[0].files[0];var g=h.type;var j=g.substr(0,5);if(j!="image"){alert("格式不正确，请重新上传");return}var i=0;if(h.size>1024*1024*10){alert("暂不支持大于10M附件上传");return}window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var d=window.URL.createObjectURL(h);f.find('img[imtype="msg_attach_src"]').attr("src",d);f.find('a[imtype="msg_attach_src_big"]').attr("href",d);var a=f.attr("content_you");var c=IM.HTML_find_contact_type();if(IM._contact_type_m==c){IM.EV_sendToDeskAttachMsg(b,h,4,a)}else{IM.EV_sendAttachMsg(b,h,4,a)}},DO_im_attachment_file:function(){var e=new Date().getTime();var d="C";var c=IM._content_you;var a=true;var f='<span imtype="msg_attach"><div class="box-wrap"><div class="imgattch_box"><img imtype="msg_attch_imgsrc"></div><p imtype="msg_attach_name" class="p-one"></p><p class="p-two"><span imtype="msg_attach_size"></span><i style="display:inline-block;height:10px;width:1px;background:#333;margin:0 3px;"></i><a imtype="msg_attach_href" href="#" target="_blank"><span style="color:#468ac9;" imtype="msg_attach_down">下载</span></a><span style="color:#468ac9;" imtype="msg_attach_sended"></span></p></div><input imtype="msg_attach_resend" type="file" style="display:none;margin: 0 auto;" onchange="IM.DO_im_attachment_file_up(\''+c+"_"+e+"', '"+e+"')\"></span>";var g=IM.HTML_sendMsg_addHTML("temp_msg",6,e,d,c,f);$("#"+g).find('input[imtype="msg_attach_resend"]').click()},DO_im_attachment_file_up:function(f,c){var g=$("#"+f);var l=g.find('input[imtype="msg_attach_resend"]')[0].files[0];var m=0;if(l.size>1024*1024*10){alert("暂不支持大于10M附件上传");return}if(l.size<1024){m=l.size+"B"}else{if(l.size<1024*1024){m=Math.ceil(l.size/1024)+"KB"}else{m=Math.ceil(l.size/(1024*1024))+"MB"}}var k=l.type;var n=k.substr(0,5);window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var e=window.URL.createObjectURL(l);if(n=="image"){g.find('img[imtype="msg_attch_imgsrc"]').attr("src",e);g.find('span[imtype="msg_attach_down"]').text("打开")}else{g.find('img[imtype="msg_attch_imgsrc"]').attr("src","img/path.png"/*tpa=http://www.aksoherb.com/webim/img/path.png*/)}g.find('img[imtype="msg_attch_imgsrc"]').css("display","block");g.find('a[imtype="msg_attach_href"]').attr("href",e);var j=l.name.lastIndexOf(".");var i=l.name.length;var h=l.name.substring(j,i);var b=l.name.substring(0,j);if(b.length>=32){b=b.substring(0,32)+"..."}g.find('p[imtype="msg_attach_name"]').html(b+h);g.find('span[imtype="msg_attach_size"]').html(m);var a=g.attr("content_you");var d=IM.HTML_find_contact_type();if(IM._contact_type_m==d){IM.EV_sendToDeskAttachMsg(c,l,6,a)}else{IM.EV_sendAttachMsg(c,l,6,a)}$("#im_attachment_file").val("")},DO_chooseEmoji:function(e,b){var a='<img imtype="content_emoji" emoji_value_unicode="'+b+'" style="width:18px; height:18px; margin:0 1px 0 1px;" src="img/img-apple-64/%27+e+%27.png"/*tpa=http://www.aksoherb.com/webim/img/img-apple-64/%27+e+%27.png*//>';if($("#im_send_content").children().length<=1){$("#im_send_content").find("p").detach();$("#im_send_content").find("br").detach();$("#im_send_content").find("div").detach()}var c=$("#im_send_content").find("br").length-1;$("#im_send_content").find("br").each(function(g){if(g==c){$(this).replaceWith("")}});var d=$("#im_send_content").find("p").length-1;$("#im_send_content").find("p").each(function(g){if(g<d){$(this).replaceWith($(this).html()+"<br>")}else{$(this).replaceWith($(this).html())}});$("#im_send_content").find("div").each(function(g){if("<br>"==$(this).html()){$(this).replaceWith("<br>")}else{$(this).replaceWith("<br>"+$(this).html())}});var f=$("#im_send_content").html();if("<br>"==f){f=""}else{f=f.replace(/(<(br)[/]?>)+/g,"\u000A")}$("#im_send_content").html(f+a)},DO_pre_replace_content:function(){setTimeout(function(){var a=IM.DO_pre_replace_content_to_db();$("#im_send_content").html(a)},20)},DO_pre_replace_content_to_db:function(){var a=$("#im_send_content").html();a=a.replace(/<(div|br|p)[/]?>/g,"\u000A");a=a.replace(/\u000A+/g,"\u000D");a=a.replace(/<[^img][^>]+>/g,"");a=a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&nbsp;/g," ");if("\u000D"==a){a=""}return a},DO_pre_range_num:function(a){},HTML_showOrHideEmojiDiv:function(){if("none"==$("#emoji_div").css("display")){$("#emoji_div").show()}else{$("#emoji_div").hide()}},_getTimeStamp:function(){var a=new Date();var b=a.getFullYear()+""+((a.getMonth()+1)>=10?(a.getMonth()+1):"0"+(a.getMonth()+1))+(a.getDate()>=10?a.getDate():"0"+a.getDate())+(a.getHours()>=10?a.getHours():"0"+a.getHours())+(a.getMinutes()>=10?a.getMinutes():"0"+a.getMinutes())+(a.getSeconds()>=10?a.getSeconds():"0"+a.getSeconds());return b}}})();